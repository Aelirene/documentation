---
title: Проксирование HTTP-запросов к стороннему сервису
keywords: sample
summary: "Раздел содержит пошаговое описание обмена сообщениями между приложением и сторонним сервисом"
sidebar: evotordoc_sidebar
permalink: doc_cloud_proxy.html
folder: evotordoc/smart_terminal_SDK
published: false
---

### Создание списка разрешённых URL

Чтобы приложение могло обмениваться сообщениями со сторонним сервисом, в настройках приложения на сайте разработчиков, требуется указать список разрешённых URL:

1. На сайте разработчиков выберите приложение, для которого требуется указать список разрешённых URL.
2. На вкладке **Интеграция**, установите флажок **ФЛАЖОК** и укажите список URL, к которым может обращаться приложение.

  Примеры:
  * `http://example\.com/document.*\.jsp\?wildcard=\*&param=value.*`;
  * `https://another\.host\.com/document.*\.jsp`;
  * `https://another\.host\.com/.*`.


После создания списка, обмен сообщениями происходит по описанному ниже процессу.

### Шаг 1. Приложение отправляет HTTP-сообщение

Приложение создаёт HTTP-сообщение и отправляет его в сторонний сервис. Вы можете воспользоваться любым удобным способом отправки сообщения.

Например, для отправки HTTP-сообщения из Java-приложения вы можете использовать [библиотеку OkHttp](http://square.github.io/okhttp/) или способ, описанный на [developer.android.com](https://developer.android.com/training/basics/network-ops/connecting.html).

Из JS-приложения вы можете отправить сообщение следующим образом:

``` JavaScript
var req = new XMLHttpRequest();
req.open("GET", "example/data.txt", false);
req.send(null);
console.log(req.responseText);
```

### Шаг 2. Терминал передаёт сообщение в облако

Терминал перехватывает сообщение и передаёт его в облако Эвотор. На этом этапе в сообщение добавляются служебные заголовки:
* `X-*`
* `Expect`
* `Host`
* `Transfer-Encoding`

{% include note.html content="Убедитесь, что ваше приложение не использует перечисленные заголовки. В противном случае, смарт-терминал перезапишет их содержимое." %}

### Шаг 3. Облако передаёт сообщение адресату

Облако удаляет служебные заголовки, добавляет свои заголовки и передаёт сообщение адресату.

Заголовки, которые добавляет облако:

* `X-Evotor-Store-Uuid` – содержит идентификатор магазина в формате uuid4, к которому привязан терминал.
* `X-Evotor-Device-UUID` – содержит идентификатор устройства в формате uuid4, полученный по запросу к `/api/v1/inventories/devices`.
* `Authorization` – содержит токен пользователя. Токен необходим для bearer-авторизации.

Сторонний сервер получает сообщение от облака Эвотор и определяет отправителя с помощью заголовка Authorization.

#### Шаг 4. Ответ стороннего сервиса

Ответ стороннего сервиса передаётся приложению в обратном порядке.

Ответы стороннего сервиса должны содержать объекты:
  * `status` – содержит HTTP-код состояния.
  * `body` – содержит тело запроса.
